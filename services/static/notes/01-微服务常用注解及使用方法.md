## 微服务常用注解及使用方法
### @EnableDiscoveryClient

#### 功能：启用服务发现客户端，使得服务能够注册到服务注册中心（如 Eureka, Consul, Nacos, Zookeeper）。它是一个通用注解。
使用方法：标注在服务提供者或服务消费者的启动类上。
示例：

```java
@SpringBootApplication
@EnableDiscoveryClient // 启用服务发现客户端
public class UserServiceApplication {
public static void main(String[] args) {
SpringApplication.run(UserServiceApplication.class, args);
}
}
```
配置文件 (application.yml)：

yaml
spring:
application:
name: user-service # 服务名称，这是其他服务调用它的标识

eureka:
client:
service-url:
defaultZone: http://localhost:8761/eureka/ # 指向 Eureka 服务器地址
2. 服务调用 (Service Invocation)
   @LoadBalanced
   功能：为 RestTemplate 或 WebClient 开启客户端负载均衡功能。使其能够通过服务名（而不是具体的IP:PORT）来调用服务，并自动在多个实例间进行负载。

使用方法：在创建 RestTemplate 或 WebClient.Builder 的 @Bean 方法上使用。

示例：

java
@Configuration
public class AppConfig {

    @Bean
    @LoadBalanced // 关键注解，让这个 RestTemplate 具有负载均衡能力
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}

@Service
public class OrderService {

    @Autowired
    private RestTemplate restTemplate; // 注入负载均衡的 RestTemplate

    public User getUserById(Long userId) {
        // 使用服务名 "user-service" 而不是 "http://localhost:8081"
        String url = "http://user-service/users/" + userId;
        return restTemplate.getForObject(url, User.class);
    }
}
@FeignClient
功能：声明一个 Feign 客户端，用于定义和调用其他服务的 HTTP API。它让你像调用本地方法一样调用远程服务，极大地简化了代码。

使用方法：标注在接口上。

属性：

name / value：指定要调用的服务名。

path：指定控制器上的父路径（可选）。

url：直接指定 URL（用于调试或非注册中心服务）。

fallback / fallbackFactory：指定服务降级的实现类。

示例：

java
// 1. 启动类上启用 Feign 客户端
@SpringBootApplication
@EnableDiscoveryClient
@EnableFeignClients // 启用 Feign 客户端扫描
public class OrderApplication {
public static void main(String[] args) {
SpringApplication.run(OrderApplication.class, args);
}
}

// 2. 定义 Feign 客户端接口
@FeignClient(name = "user-service", path = "/api") // 对应服务名 user-service
public interface UserServiceClient {

    @GetMapping("/users/{id}") // 与服务提供者的 Controller 映射一致
    User getUserById(@PathVariable("id") Long id);

    @PostMapping("/users")
    User createUser(@RequestBody User user);
}

// 3. 在业务类中注入并使用
@Service
public class OrderService {

    @Autowired
    private UserServiceClient userServiceClient; // 像调用本地接口一样
    
    public void processOrder(Long userId) {
        User user = userServiceClient.getUserById(userId); // 实际是远程调用
        // ... 处理订单逻辑
    }
}
3. 服务熔断与降级 (Circuit Breaker & Fallback)
   @HystrixCommand (Spring Cloud Netflix，已进入维护模式)
   功能：为方法添加熔断、线程池隔离、降级等保护能力。

使用方法：标注在需要保护的方法上，并指定降级方法。

示例：

java
@Service
public class UserService {

    @Autowired
    private RestTemplate restTemplate;

    @HystrixCommand(fallbackMethod = "getUserByIdFallback") // 指定降级方法
    public User getUserById(Long id) {
        String url = "http://user-service/users/" + id;
        return restTemplate.getForObject(url, User.class);
    }

    // 降级方法，签名与原方法一致
    public User getUserByIdFallback(Long id) {
        return new User(-1L, "默认用户", "服务暂时不可用");
    }
}
@EnableCircuitBreaker
功能：在项目中启用断路器支持（与 @HystrixCommand 配合使用）。

使用方法：标注在启动类上。

Spring Cloud Alibaba Sentinel (推荐替代方案)
@SentinelResource:

功能：定义资源，并提供熔断降级和流量控制的处理逻辑。

示例：

java
@Service
public class TestService {

    // 定义资源名为 ‘getUser’，并指定 blockHandler 和 fallback 方法
    @SentinelResource(value = "getUser", 
                      blockHandler = "handleBlock", // 处理流控/降级规则触发的异常
                      fallback = "handleFallback")  // 处理业务异常
    public User getUserById(String id) {
        // 模拟业务逻辑
        return userService.getUser(id);
    }

    // Block 异常处理函数，参数列表最后必须有一个 BlockException 参数
    public User handleBlock(String id, BlockException ex) {
        return new User("流控用户", "触发流控");
    }

    // Fallback 函数，参数列表最后必须有一个 Throwable 参数
    public User handleFallback(String id, Throwable t) {
        return new User("降级用户", "业务异常: " + t.getMessage());
    }
}
4. 配置管理 (Configuration Management)
   @EnableConfigServer
   功能：声明一个配置中心服务器，从 Git、SVN 等仓库集中管理配置文件。

使用方法：标注在启动类上。

示例：

java
@SpringBootApplication
@EnableConfigServer // 启用配置服务器
public class ConfigServerApplication {
public static void main(String[] args) {
SpringApplication.run(ConfigServerApplication.class, args);
}
}
@RefreshScope
功能：标记一个 Bean 的作用域为可刷新的。当配置中心的值发生变化时，可以通过 /actuator/refresh 端点来刷新这些配置，而无需重启服务。

使用方法：通常标注在使用 @Value 或 @ConfigurationProperties 的类上。

示例：

java
@RestController
@RefreshScope // 关键注解，允许动态刷新配置
public class ConfigController {

    @Value("${app.message: Hello default}") // 从配置中心获取 app.message
    private String message;

    @GetMapping("/message")
    public String getMessage() {
        return this.message;
    }
}
当你在 Git 上修改了 app.message 的值后，调用 POST http://服务地址:端口/actuator/refresh，message 字段的值就会被更新。

5. API 网关 (API Gateway)
   @EnableZuulProxy (Spring Cloud Netflix，已进入维护模式)
   功能：启用 Zuul 网关代理，提供动态路由、监控、弹性、安全等功能。

Spring Cloud Gateway (推荐替代方案)
Spring Cloud Gateway 是基于 WebFlux 的响应式 API 网关，配置通常是基于 application.yml 文件，而非注解。

配置文件示例：

yaml
spring:
cloud:
gateway:
routes:
- id: user-service-route   # 路由 ID
uri: lb://user-service   # 目标服务 URI，lb:// 表示负载均衡
predicates:
- Path=/api/user/**    # 路径断言，匹配 /api/user/ 开头的请求
filters:
- StripPrefix=1        # 过滤器，去掉路径的第一部分（/api）
- id: order-service-route
uri: lb://order-service
predicates:
- Path=/api/order/**
filters:
- StripPrefix=1
总结
分类	注解	作用	备注
服务发现	@EnableEurekaServer	启用 Eureka 注册中心
@EnableDiscoveryClient	启用服务发现客户端	通用注解，推荐
服务调用	@LoadBalanced	为 RestTemplate 开启负载均衡
@FeignClient	声明一个声明式的 REST 客户端	更优雅的调用方式
熔断降级	@HystrixCommand	Hystrix 熔断命令	Netflix 组件，已维护
@EnableCircuitBreaker	启用断路器支持
@SentinelResource	Sentinel 资源定义与降级	Alibaba 组件，推荐
配置中心	@EnableConfigServer	启用配置中心服务器
@RefreshScope	允许动态刷新配置
API网关	@EnableZuulProxy	启用 Zuul 网关	Netflix 组件，已维护
(基于配置)	Spring Cloud Gateway	推荐，性能更好